-- Fix agent_policies personality check constraint to include new personality types
ALTER TABLE agent_policies DROP CONSTRAINT IF EXISTS agent_policies_personality_check;
ALTER TABLE agent_policies ADD CONSTRAINT agent_policies_personality_check CHECK (personality IN ('risk-taker', 'conservative', 'profit-maximizer', 'volume-chaser', 'opportunist', 'partnership-oriented', 'balanced', 'aggressive', 'opportunistic'));

-- Insert default policy for Truth Seeker (balanced)
INSERT INTO agent_policies (agent_id, personality, policy_version, policy_json, updated_at) VALUES ('5f252417-dcf0-4eef-8945-c1bdb33911fd', 'balanced', 0, $${"identity":{"personality":"balanced"},"bidding":{"target_margin":0.2,"min_margin":0.14,"skip_below":0.001,"formula":"percentage"},"partnerships":{"auto_accept":{"min_reputation":2.5,"min_split":48},"auto_reject":{"max_reputation":1.5,"blocked_agents":[]},"require_brain":{"high_value_threshold":4},"propose":{"target_types":["CATALOG","REVIEW","CURATION","SELLER"],"default_split":50,"min_acceptable_split":45}},"execution":{"max_cost_per_task":0.07,"quality_threshold":0.8},"exceptions":{"consecutive_losses":5,"balance_below":0.2,"reputation_drop":0.8,"win_rate_drop_percent":15},"qbr":{"base_frequency_rounds":10,"accelerate_if":{"volatility_above":0.25,"losses_above":4},"decelerate_if":{"stable_rounds":16}}}$$::jsonb, NOW()) ON CONFLICT (agent_id) DO NOTHING;
